/****************************************************************************
Copyright (C), 2013, Mingv150, All rights reserved
FileName: Drv_LcdGuiBasic.c
Description:
Author:
Version:
Changelog:
*****************************************************************************/

# define _Drv_LcdGuiBasic_C_
/*common header file*/
# include "Common.h"
# include "lw_oopc.h"
# include "Drv_LcdModel.h"
/*my header file*/
# include "Drv_LcdHardware.h"
# include "Drv_LcdSPLC502B.h"
# include "Drv_LcdGuiBasic.h"


/*Global Data Structure*/
const u8 SZK16[] =
{
    0x00
};


const u8 Asii0610[] =
{
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x60, 0x00, 0x00,
    0xA0, 0xA0, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0x28, 0xFC, 0x50, 0xFC, 0x50, 0x50, 0x00, 0x00,
    0x20, 0x70, 0xA8, 0xA0, 0x70, 0x28, 0xA8, 0x70, 0x20, 0x00,
    0x00, 0xC8, 0xD0, 0xD0, 0x20, 0x58, 0x58, 0x98, 0x00, 0x00, 0x00, 0x20, 0x50, 0x20, 0x60, 0x98, 0x90, 0x68, 0x00, 0x00,
    0x40, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x20, 0x40, 0x40, 0x40, 0x40, 0x40, 0x20, 0x10, 0x00,
    0x80, 0x40, 0x20, 0x20, 0x20, 0x20, 0x20, 0x40, 0x80, 0x00, 0x00, 0x20, 0xA8, 0x70, 0x70, 0xA8, 0x20, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x20, 0x20, 0x70, 0x20, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x40, 0x80, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x00,
    0x10, 0x10, 0x20, 0x20, 0x40, 0x40, 0x80, 0x80, 0x00, 0x00, 0x00, 0x60, 0x90, 0x90, 0x90, 0x90, 0x90, 0x60, 0x00, 0x00,
    0x00, 0x20, 0x60, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00, 0x00, 0x60, 0x90, 0x10, 0x20, 0x40, 0x80, 0xF0, 0x00, 0x00,
    0x00, 0x60, 0x90, 0x10, 0x60, 0x10, 0x90, 0x60, 0x00, 0x00, 0x00, 0x30, 0x30, 0x50, 0x50, 0x90, 0xF8, 0x10, 0x00, 0x00,
    0x00, 0xF0, 0x80, 0xE0, 0x10, 0x10, 0x90, 0x60, 0x00, 0x00, 0x00, 0x60, 0x90, 0x80, 0xE0, 0x90, 0x90, 0x60, 0x00, 0x00,
    0x00, 0xF0, 0x10, 0x20, 0x20, 0x40, 0x40, 0x40, 0x00, 0x00, 0x00, 0x60, 0x90, 0x90, 0x60, 0x90, 0x90, 0x60, 0x00, 0x00,
    0x00, 0x60, 0x90, 0x90, 0x70, 0x10, 0x90, 0x60, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00,
    0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x60, 0x20, 0x40, 0x00, 0x00, 0x10, 0x20, 0x40, 0x80, 0x40, 0x20, 0x10, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xF0, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x20, 0x10, 0x20, 0x40, 0x80, 0x00, 0x00,
    0x00, 0x60, 0x90, 0x10, 0x20, 0x20, 0x00, 0x20, 0x20, 0x00, 0x00, 0x70, 0x88, 0xB8, 0xA8, 0xB8, 0x80, 0x70, 0x00, 0x00,
    0x00, 0x60, 0x60, 0x90, 0x90, 0xF0, 0x90, 0x90, 0x00, 0x00, 0x00, 0xE0, 0x90, 0x90, 0xE0, 0x90, 0x90, 0xE0, 0x00, 0x00,
    0x00, 0x60, 0x90, 0x80, 0x80, 0x80, 0x90, 0x60, 0x00, 0x00, 0x00, 0xE0, 0x90, 0x90, 0x90, 0x90, 0x90, 0xE0, 0x00, 0x00,
    0x00, 0xF0, 0x80, 0x80, 0xE0, 0x80, 0x80, 0xF0, 0x00, 0x00, 0x00, 0xF0, 0x80, 0x80, 0xE0, 0x80, 0x80, 0x80, 0x00, 0x00,
    0x00, 0x60, 0x90, 0x80, 0xB0, 0x90, 0x90, 0x70, 0x00, 0x00, 0x00, 0x90, 0x90, 0x90, 0xF0, 0x90, 0x90, 0x90, 0x00, 0x00,
    0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x00, 0x00, 0x10, 0x10, 0x10, 0x10, 0x10, 0x90, 0x60, 0x00, 0x00,
    0x00, 0x90, 0x90, 0xA0, 0xC0, 0xA0, 0x90, 0x90, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xF0, 0x00, 0x00,
    0x00, 0x88, 0x88, 0xD8, 0xD8, 0xA8, 0xA8, 0xA8, 0x00, 0x00, 0x00, 0x90, 0x90, 0xD0, 0xD0, 0xB0, 0xB0, 0x90, 0x00, 0x00,
    0x00, 0x60, 0x90, 0x90, 0x90, 0x90, 0x90, 0x60, 0x00, 0x00, 0x00, 0xE0, 0x90, 0x90, 0x90, 0xE0, 0x80, 0x80, 0x00, 0x00,
    0x00, 0x60, 0x90, 0x90, 0x90, 0xD0, 0xA0, 0x50, 0x00, 0x00, 0x00, 0xE0, 0x90, 0x90, 0xE0, 0x90, 0x90, 0x90, 0x00, 0x00,
    0x00, 0x60, 0x90, 0x80, 0x60, 0x10, 0x90, 0x60, 0x00, 0x00, 0x00, 0xF0, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x00,
    0x00, 0x90, 0x90, 0x90, 0x90, 0x90, 0x90, 0x60, 0x00, 0x00, 0x00, 0x88, 0x88, 0x88, 0x50, 0x50, 0x20, 0x20, 0x00, 0x00,
    0x00, 0xA8, 0xA8, 0xA8, 0xA8, 0x50, 0x50, 0x50, 0x00, 0x00, 0x00, 0x90, 0x90, 0x60, 0x60, 0x60, 0x90, 0x90, 0x00, 0x00,
    0x00, 0x88, 0x88, 0x50, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00, 0x00, 0xF0, 0x10, 0x20, 0x20, 0x40, 0x80, 0xF0, 0x00, 0x00,
    0x30, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x30, 0x00, 0x00, 0x88, 0x50, 0x20, 0xF0, 0x20, 0xF0, 0x20, 0x00, 0x00,
    0xC0, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0xC0, 0x00, 0x40, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x00, 0x80, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xE0, 0x10, 0x70, 0x90, 0x70, 0x00, 0x00, 0x00, 0x80, 0x80, 0xE0, 0x90, 0x90, 0x90, 0xE0, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x60, 0x90, 0x80, 0x90, 0x60, 0x00, 0x00, 0x00, 0x10, 0x10, 0x70, 0x90, 0x90, 0x90, 0x70, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x60, 0x90, 0xF0, 0x80, 0x70, 0x00, 0x00, 0x00, 0x60, 0x40, 0xF0, 0x40, 0x40, 0x40, 0x40, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x50, 0xA0, 0xA0, 0x40, 0xB0, 0x90, 0x60, 0x00, 0x80, 0x80, 0xE0, 0x90, 0x90, 0x90, 0x90, 0x00, 0x00,
    0x00, 0x20, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00, 0x00, 0x20, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0xE0, 0x00,
    0x00, 0x80, 0x80, 0x90, 0xA0, 0xE0, 0x90, 0x90, 0x00, 0x00, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xD0, 0xA8, 0xA8, 0xA8, 0xA8, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x90, 0x90, 0x90, 0x90, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x60, 0x90, 0x90, 0x90, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x90, 0x90, 0xE0, 0x80, 0x80, 0x00,
    0x00, 0x00, 0x00, 0x70, 0x90, 0x90, 0x70, 0x10, 0x10, 0x00, 0x00, 0x00, 0x00, 0xA0, 0xC0, 0x80, 0x80, 0x80, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x70, 0x80, 0x60, 0x10, 0xE0, 0x00, 0x00, 0x00, 0x40, 0x40, 0xF0, 0x40, 0x40, 0x40, 0x60, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x90, 0x90, 0x90, 0x90, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x90, 0x90, 0x90, 0x60, 0x60, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xA8, 0xA8, 0xA8, 0x50, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x90, 0x60, 0x60, 0x90, 0x90, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x90, 0x90, 0x50, 0x20, 0x20, 0x40, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x20, 0x40, 0x80, 0xF0, 0x00, 0x00,
    0x30, 0x20, 0x20, 0x20, 0x40, 0x20, 0x20, 0x20, 0x30, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
    0xC0, 0x40, 0x40, 0x40, 0x20, 0x40, 0x40, 0x40, 0xC0, 0x00, 0x50, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

static LCDInterface *pFace = NULL;


/****************************************************************************
Function: void Drv_LcdGuiBasic_InitGui()
Description:
Input:
Output:
*****************************************************************************/
void Drv_LcdGuiBasic_InitGui()
{
    // 更换不同的LCD，请修改这里
    static Splc502b *pLcd = NULL;

    pLcd = Splc502b_new();
    pFace = SUPER_PTR(pLcd,LCDInterface);
    pFace->Init(pFace);
    pFace->FillScreen(pFace,0);
}


/****************************************************************************
Function: u16 Drv_LcdGuiBasic_GetXMax(void)
Description:
Input:
Output:
*****************************************************************************/
u16 Drv_LcdGuiBasic_GetXMax(void)
{
    return (u16)pFace->GetXMax(pFace);
}


/****************************************************************************
Function: u16 Drv_LcdGuiBasic_GetYMax(void)
Description:
Input:
Output:
*****************************************************************************/
u16 Drv_LcdGuiBasic_GetYMax(void)
{
    return (u16)pFace->GetYMax(pFace);
}


/****************************************************************************
Function: void Drv_LcdGuiBasic_PutPixel(u16 x, u16 y, u8 color)
Description:
Input:
Output:
*****************************************************************************/
void Drv_LcdGuiBasic_PutPixel(u16 x, u16 y, u32 color)
{
    pFace->WriteDot(pFace, x, y, color);
}


/****************************************************************************
Function: void Drv_LcdGuiBasic_Drawfont(u8 Fonttype, u16 x, u16 y, u8 Font)
Description:
Input:
Output:
*****************************************************************************/
void Drv_LcdGuiBasic_Drawfont(u8 Fonttype, u16 x, u16 y, u8 Font)
{
    u8 i, j;
    u8 *p_data;
    u8 Temp;
    u8 Index = 0;

    u8 FontSize;
    u8 XWidth;
    u8 YWidth;
    u8 *FontTab;

    switch (Fonttype)
    {
    case GUIBASIC_ASCII:
        FontSize = 10;
        XWidth = 6;
        YWidth = 10;
        FontTab = (unsigned char * )(Asii0610 - (32 * 10));
        break;
    case GUIBASIC_GB1716:
        FontSize = 48;
        XWidth = 17;
        YWidth = 16;
        //FontTab = (unsigned char *)GB1716;
        break;
    default:
        break;
    }

    p_data = FontTab + Font * FontSize;
    j = 0;

    while ((j++) < YWidth)
    {
        if (y > pFace->GetYMax(pFace)) break;

        i = 0;

        while (i < XWidth)
        {
            if ((i & 0x07) == 0)
            {
                Temp = * (p_data + Index);
                Index++;
            }

            if ((Temp & 0x80) > 0) pFace->WriteDot(pFace, x + i, y, 1);

            Temp = Temp << 1;

            if ((x + i) >= pFace->GetXMax(pFace))
            {
                Index += (XWidth - i) >> 3;
                break;
            }

            i++;
        }
        y++;
    }
}


/****************************************************************************
Function: void Drv_LcdGuiBasic_DrawString(u8 Fonttype, u16 x, u16 y, s8 Font)
Description:
Input:
Output:
*****************************************************************************/
void Drv_LcdGuiBasic_DrawString(u8 Fonttype, u16 x, u16 y, u8 *str)
{
    //u8 FontSize;
    u8 XWidth;
    u8 YWidth;
    //u8 *FontTab;

    switch (Fonttype)
    {
    case GUIBASIC_ASCII:
        //FontSize = 10;
        XWidth = 6;
        YWidth = 10;
        //FontTab = (unsigned char * )(Asii0610 - (32 * 10));
        break;
    case GUIBASIC_GB1716:
        //FontSize = 48;
        XWidth = 17;
        YWidth = 16;
        //FontTab = (unsigned char *)GB1716;
        break;
    default:
        break;
    }

    while (*str != 0)
    {
        Drv_LcdGuiBasic_Drawfont(Fonttype, x, y, *str);
        x += XWidth;
        if ((x + XWidth) > pFace->GetXMax(pFace))
        {
            x = 0;
            if ((pFace->GetYMax(pFace) - y) < YWidth) break;
            else y += YWidth;
        }
        str++;
    }
}


/****************************************************************************
Function: void Drv_LcdGuiBasic_Line(u16 x_start, u16 y_start, u16 x_end, u16 y_end)
Description:
Input:
Output:
*****************************************************************************/
void Drv_LcdGuiBasic_Line(u16 x_start, u16 y_start, u16 x_end, u16 y_end)
{
    s16 Offset_x, Offset_y, Offset_k = 0;
    s16 Err_d = 1;

    if (y_start > y_end)
    {
        Offset_x = x_start;
        x_start = x_end;
        x_end = Offset_x;

        Offset_x = y_start;
        y_start = y_end;
        y_end = Offset_x;
    }

    Offset_x = x_end - x_start;
    Offset_y = y_end - y_start;

    pFace->WriteDot(pFace, x_start, y_start, 1);

    if (Offset_x < 0)
    {
        Offset_x = x_start - x_end;
        Err_d = -1;
    }
    else if (Offset_x == 0)
    {
        Err_d = 0;
    }
    else
    {
        Err_d = 1;
    }

    if (Offset_x > Offset_y)
    {
        Offset_k += Offset_y;
        while (x_start != x_end)
        {
            if (Offset_k > 0)
            {
                y_start += 1;
                Offset_k += (Offset_y - Offset_x);
            }
            else 
                Offset_k += Offset_y;
            x_start += Err_d;
            if (x_start > pFace->GetXMax(pFace) || y_start > pFace->GetYMax(pFace)) 
                break;
            pFace->WriteDot(pFace, x_start, y_start, 1);
        }
    }
    else
    {
        Offset_k += Offset_x;
        while (y_start != y_end)
        {
            if (Offset_k >= 0)
            {
                x_start += Err_d;
                Offset_k += (Offset_x - Offset_y);
            }
            else Offset_k += Offset_x;
            y_start += 1;
            if (x_start >= pFace->GetXMax(pFace) || y_start >= pFace->GetYMax(pFace)) break;
            pFace->WriteDot(pFace, x_start, y_start, 1);
        }
    }
}

/****************************************************************************
Function: void Drv_LcdGuiBasic_RectangleFill(u16 x1, u16 y1, u16 x2, u16 y2, u8 Mode)
Description:
Input:
Output:
*****************************************************************************/
void Drv_LcdGuiBasic_RectangleFill(u16 x1, u16 y1, u16 x2, u16 y2, u8 Mode)
{
    u8 uiTemp;

    if (Mode == 0)
    {
        Drv_LcdGuiBasic_Line(x1, y1, x1, y2);
        Drv_LcdGuiBasic_Line(x1, y1, x2, y1);
        Drv_LcdGuiBasic_Line(x2, y2, x1 + 1, y2);
        Drv_LcdGuiBasic_Line(x2, y2, x2, y1 + 1);
    }
    else
    {
        if (x1 > x2)
        {
            uiTemp = x1;
            x1 = x2;
            x2 = uiTemp;
        }
        if (y1 > y2)
        {
            uiTemp = y1;
            y1 = y2;
            y2 = uiTemp;
        }
        for (uiTemp = y1; uiTemp <= y2; uiTemp++)
        {
            Drv_LcdGuiBasic_Line(x1, uiTemp, x2, uiTemp);
        }
    }
}


