/*******************************************************************************
*Copyright(C),2012-2013,mingv150,All rights reserved
*FileName:
*Description:
*Author:
*Version:
*Date:
*******************************************************************************/

#define _DRV_NTC_C_
#include <stdio.h>
#include <stdlib.h>
#include "Drv_NTC.h"


/*Tab:温度阻值表*/
u32 TempTab[]=
{
    0x7efe,0x78ee,0x733b,0x6dd8,0x68bd,0x63e2,0x5f40,0x5ad4,0x5698,0x528c, //0~9℃
    0x4eac,0x4ad3,0x4753,0x4417,0x410f,0x3e2f,0x3b6f,0x38ca,0x363e,0x33c8,
    0x3168,0x2f20,0x2cf1,0x2add,0x28e7,0x2710,0x255b,0x23ca,0x225f,0x211b,
    0x2002,0x1ec0,0x1d85,0x1c51,0x1b23,0x19fc,0x18dd,0x17c8,0x16be,0x15bf,
    0x14ce,0x1392,0x1319,0x1258,0x11aa,0x110e,0x1061,0x0fbd,0x0f22,0x0e8f,
    0x0e04,0x0d7f,0x0d01,0x0c88,0x0c13,0x0ba3,0x0b36,0x0acd,0x0a66,0x0a01,
    0x099e,0x0945,0x08f1,0x089c,0x084c,0x07ff,0x07b5,0x076e,0x072a,0x06e9,
    0x06aa,0x066f,0x0636,0x0600,0x05cc,0x059b,0x056e,0x0542,0x0517,0x04ef,
    0x04c8,0x04a2,0x047d,0x0459,0x0436,0x0414,0x03f2,0x03d1,0x03b1,0x0391,
    0x0371,0x0355,0x033a,0x0320,0x0308,0x02f0,0x02da,0x02c4,0x02af,0x029a,
    0x0286,0x0272,0x025f,0x024b,0x0238,0x0225,0x0216,0x0207,0x01f8,0x01e9,
    0x01da,0x01cc,0x01be,0x01b0,0x01a3,0x0197,0x018b,0x0180,0x0175,0x016b,
    0x0162,0x0157,0x014d,0x0144,0x013c,0x0133,0x012b,0x0124,0x011d,0x0116,
    0x010f,0x0108,0x0101,0x00fb,0x00f4,0x00ed,0x00e6,0x00e0,0x00d9,0x00d4,
    0x00ce,0x00c9,0x00c3,0x00bf,0x00ba,0x00b6,0x00b1,0x00ae,0x00aa,0x00a6,
    0x00a3,0x009e,0x009a,0x0096,0x0092,0x008f,0x008c,0x0089,0x0085,0x0082, //150~159℃
    0x007f
};


/*******************************************************************************
*Function:
*Description: 求得阻值为ResVal所在的温度范围为TempMin~TempMax（相差1度）之间
*Input:
*Output:
*******************************************************************************/
float Drv_NTC_CheckTem(u32 ResVal)
{
    float Temperature;
    float k;
    static u8 TempMin = 0;
    static u8 TempMax = sizeof(TempTab)/sizeof(TempTab[0]) -1;
    static u8 MidVal;

    /*二分法查找*/
    while(ResVal >= TempTab[TempMax])
    {
        MidVal = (TempMax + TempMin)/2;

        if((MidVal == TempMin)||(MidVal == TempMax))
        {
            break;
        }
        if(ResVal >= TempTab[MidVal])
        {
            TempMax = MidVal;
        }
        else
        {
            TempMin = MidVal;
        }
    }

    /*线性插值法*/
    k = (TempMax- TempMin);
    k /= (TempTab[TempMin] - TempTab[TempMax]);
    Temperature = TempMax + k*(ResVal - TempTab[TempMax]);
    return Temperature;
}
